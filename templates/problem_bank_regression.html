<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regression Analysis - Problem Bank</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;300;400;500;600;700;800;900&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background: #0E0E0F; min-height: 100vh; color: #FFFFFF; letter-spacing: 0.01em; line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; background: #1A1B1F; box-shadow: 0 0 60px rgba(0, 201, 242, 0.08); }
        .glass-card { background: #1A1B1F; padding: 40px; border-bottom: 1px solid rgba(191, 196, 201, 0.1); animation: fadeInUp 400ms cubic-bezier(0.4, 0, 0.2, 1) forwards; opacity: 0; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .glass-card:nth-child(1) { animation-delay: 100ms; }
        .glass-card:nth-child(2) { animation-delay: 200ms; }
        .glass-card:nth-child(3) { animation-delay: 300ms; }
        .glass-card:nth-child(4) { animation-delay: 400ms; }
        .header { text-align: center; padding: 48px 40px 32px; background: linear-gradient(180deg, #1A1B1F 0%, #0E0E0F 100%); border-bottom: 1px solid rgba(191, 196, 201, 0.15); }
        .header h1 { font-size: 32px; font-weight: 600; margin-bottom: 12px; letter-spacing: 0.5px; text-transform: uppercase; background: linear-gradient(90deg, #FFFFFF 0%, #00C9F2 100%); background-clip: text; -webkit-text-fill-color: transparent; }
        .header p { color: #BFC4C9; font-size: 14px; font-weight: 300; letter-spacing: 0.5px; }
        .nav-buttons { display: flex; gap: 2px; justify-content: center; margin: 32px 0 0; padding-top: 24px; border-top: 1px solid rgba(191, 196, 201, 0.1); flex-wrap: wrap; }
        .nav-btn { padding: 12px 28px; background: transparent; color: #BFC4C9; border: 1px solid rgba(191, 196, 201, 0.2); cursor: pointer; text-decoration: none; font-size: 13px; letter-spacing: 0.8px; text-transform: uppercase; transition: all 200ms cubic-bezier(0.4, 0, 0.2, 1); }
        .nav-btn:first-child { border-radius: 6px 0 0 6px; }
        .nav-btn:last-child { border-radius: 0 6px 6px 0; }
        .nav-btn:hover { background: rgba(0, 201, 242, 0.08); border-color: #00C9F2; color: #00C9F2; box-shadow: 0 0 20px rgba(0, 201, 242, 0.15); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 24px 0; }
        .stat-card { background: rgba(14, 35, 63, 0.3); padding: 28px; border-radius: 8px; text-align: center; border: 1px solid rgba(0, 201, 242, 0.15); transition: all 200ms; }
        .stat-card:hover { border-color: #00C9F2; box-shadow: 0 0 30px rgba(0, 201, 242, 0.2); transform: scale(1.02) translateY(-2px); }
        .stat-card h3 { font-size: 11px; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 1.2px; color: #BFC4C9; font-weight: 600; }
        .stat-card .value { font-size: 36px; font-weight: 600; margin: 12px 0; color: #11E0C1; }
        .stat-card .label { font-size: 12px; color: #BFC4C9; font-weight: 300; }
        .section-title { text-align: center; margin-bottom: 32px; font-size: 20px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; border-bottom: 2px solid #00C9F2; padding-bottom: 12px; display: inline-block; width: 100%; }
        .visualization-section { text-align: center; padding: 40px; }
        .model-plot { max-width: 900px; margin: 0 auto 30px; border-radius: 8px; overflow: hidden; border: 1px solid rgba(191, 196, 201, 0.15); transition: all 200ms; cursor: pointer; }
        .model-plot:hover { transform: scale(1.01) translateY(-2px); box-shadow: 0 8px 40px rgba(0, 201, 242, 0.25); }
        .model-plot img { width: 100%; height: auto; display: block; background: #0E0E0F; }
        .interpretation-box { background: rgba(14, 35, 63, 0.4); padding: 36px; border-radius: 8px; text-align: center; border: 1px solid rgba(0, 201, 242, 0.2); }
        .interpretation-box h3 { margin-bottom: 20px; font-size: 16px; font-weight: 600; letter-spacing: 1px; text-transform: uppercase; }
        .interpretation-box p { font-size: 14px; line-height: 1.8; color: #BFC4C9; font-weight: 300; }
        .r2-badge { display: inline-block; background: rgba(17, 224, 193, 0.15); color: #11E0C1; padding: 12px 24px; border-radius: 6px; font-weight: 600; font-size: 14px; margin: 20px 0 0; border: 1px solid rgba(17, 224, 193, 0.3); letter-spacing: 0.8px; text-transform: uppercase; }
        .insights-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 24px 0; }
        .insight-card { background: rgba(14, 35, 63, 0.3); padding: 28px; border-radius: 8px; border-left: 3px solid #11E0C1; border: 1px solid rgba(191, 196, 201, 0.15); transition: all 200ms; }
        .insight-card:hover { transform: translateX(4px); border-left-color: #00C9F2; box-shadow: 0 8px 30px rgba(0, 201, 242, 0.15); }
        .insight-card h4 { color: #FFFFFF; margin-bottom: 12px; font-size: 14px; font-weight: 600; }
        .insight-card p { color: #BFC4C9; line-height: 1.7; font-size: 13px; font-weight: 300; }
        .insight-card strong { color: #11E0C1; font-weight: 600; }
        #imageModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(8px); }
        .modal-content { background: #1A1B1F; padding: 32px; border-radius: 8px; max-width: 90%; max-height: 90%; position: relative; border: 1px solid rgba(0, 201, 242, 0.3); box-shadow: 0 20px 80px rgba(0, 201, 242, 0.3); }
        .modal-content span { position: absolute; top: 16px; right: 16px; font-size: 32px; cursor: pointer; color: #BFC4C9; transition: all 150ms; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(191, 196, 201, 0.1); }
        .modal-content span:hover { color: #00C9F2; background: rgba(0, 201, 242, 0.15); transform: rotate(90deg); }
        #modalImage { max-width: 100%; max-height: 80vh; border-radius: 8px; }
        @media (max-width: 768px) { .stats-grid, .insights-grid { grid-template-columns: 1fr; } .nav-buttons { flex-direction: column; } .nav-btn { width: 100%; border-radius: 6px !important; } .glass-card { padding: 24px; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="glass-card header">
            <h1>Regression Analysis</h1>
            <p>Multiple Linear Regression: Predicting Problem Solving Time</p>
            <div class="nav-buttons">
                <a href="/" class="nav-btn">Home</a>
                <a href="/problem_bank" class="nav-btn">Main Dashboard</a>
                <a href="/problem_bank/hypothesis" class="nav-btn">Hypothesis Testing</a>
            </div>
        </div>

        <div class="glass-card">
            <h2 class="section-title">Model Performance Metrics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>R² Score (Test)</h3>
                    <div class="value">{{ regression.r2_test }}</div>
                    <div class="label">Variance Explained</div>
                </div>
                <div class="stat-card">
                    <h3>RMSE</h3>
                    <div class="value">{{ regression.rmse }}s</div>
                    <div class="label">Root Mean Square Error</div>
                </div>
                <div class="stat-card">
                    <h3>MAE</h3>
                    <div class="value">{{ regression.mae }}s</div>
                    <div class="label">Mean Absolute Error</div>
                </div>
                <div class="stat-card">
                    <h3>Test Size</h3>
                    <div class="value">{{ regression.test_size }}</div>
                    <div class="label">Samples Evaluated</div>
                </div>
            </div>
        </div>

        <div class="glass-card visualization-section">
            <h2 class="section-title">Actual vs Predicted Solving Time</h2>
            <div class="model-plot">
                <img src="{{ url_for('static', filename=actual_predicted) }}" 
                     alt="Actual vs Predicted"
                     onclick="openModal(this.src)">
            </div>
            <div class="interpretation-box">
                <h3>Model Performance</h3>
                <p>{{ regression.interpretation }}</p>
                <div class="r2-badge">R² = {{ regression.r2_test }} | RMSE = {{ regression.rmse }}s</div>
            </div>
        </div>

        <div class="glass-card visualization-section">
            <h2 class="section-title">Feature Coefficients</h2>
            <div class="model-plot">
                <img src="{{ url_for('static', filename=coefficients) }}" 
                     alt="Feature Coefficients"
                     onclick="openModal(this.src)">
            </div>
            <div class="interpretation-box">
                <h3>What Drives Solving Time?</h3>
                <p><strong>Top Factor:</strong> {{ regression.top_feature }} (Coefficient: {{ regression.top_coefficient }})</p>
                <p style="margin-top: 16px;">{{ regression.equation }}</p>
            </div>
        </div>

        <div class="glass-card">
            <h2 class="section-title">Key Insights</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <h4>Difficulty Impact</h4>
                    <p>Problem difficulty is a <strong>strong predictor</strong> of solving time. Each difficulty level increase adds significant time.</p>
                </div>
                <div class="insight-card">
                    <h4>Complexity Matters</h4>
                    <p>Equation complexity score <strong>directly correlates</strong> with solving duration. More complex equations require more time.</p>
                </div>
                <div class="insight-card">
                    <h4>Problem Length</h4>
                    <p>Longer problems (more words) generally take <strong>more time</strong> to read and solve.</p>
                </div>
                <div class="insight-card">
                    <h4>Predictive Power</h4>
                    <p>The model explains <strong>{{ (regression.r2_test * 100)|round(1) }}%</strong> of variance in solving time with these factors.</p>
                </div>
            </div>
        </div>

        
    </div>

    <div id="imageModal">
        <div class="modal-content">
            <span onclick="closeModal()">&times;</span>
            <img id="modalImage" src="" alt="Enlarged view">
        </div>
    </div>

    <script>
        function openModal(imageSrc) { document.getElementById('modalImage').src = imageSrc; document.getElementById('imageModal').style.display = 'flex'; }
        function closeModal() { document.getElementById('imageModal').style.display = 'none'; }
        window.onclick = function(event) { if (event.target === document.getElementById('imageModal')) closeModal(); }
    </script>
</body>
</html>